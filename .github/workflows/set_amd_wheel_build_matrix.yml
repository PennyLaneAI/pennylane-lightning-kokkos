name: Set wheel build matrix

env:
  PYTHON3_MIN_VERSION: "8"
  PYTHON3_MAX_VERSION: "11"

on:
  workflow_call:
    inputs:
      event_name:
        required: true
        type: string
    outputs:
      python_version:
        description: "Python versions."
        value: ${{ jobs.set-builder-matrix.outputs.python_version }}
      exec_model:
        description: "The wheel building model."
        value: ${{ jobs.set-builder-matrix.outputs.exec_model }}
      amd_arch:
        description: "AMD GPU architecture."
        value: ${{ jobs.set-builder-matrix.outputs.amd_arch }}

jobs:
  set-builder-matrix:
    runs-on: ubuntu-20.04

    steps:
      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.11.0
        with:
          access_token: ${{ github.token }}

      - name: Checkout PennyLane-Lightning-Kokkos
        uses: actions/checkout@v3

      - name: Python version
        id: pyver
        run: |
          if [[ ${{ inputs.event_name }} == 'pull_request' ]]; then
            echo "::set-output name=python_version::$(python3 scripts/gen_pyver_matrix.py \
              --min-version=3.${{ env.PYTHON3_MIN_VERSION }} \
              --max-version=3.${{ env.PYTHON3_MAX_VERSION }})"
          else
            echo "::set-output name=python_version::$(python3 scripts/gen_pyver_matrix.py \
              --min-version=3.${{ env.PYTHON3_MIN_VERSION }} \
              --max-version=3.${{ env.PYTHON3_MAX_VERSION }} \
              --range)"
          fi

      - name: Wheels building strategy
        id: exec_model
        run: echo "::set-output name=exec_model::[\"HIP\"]"

      - name: AMD GPU architecture
        id: amd_arch
        run: echo "::set-output name=amd_arch::[\"VEGA900\",\"VEGA906\",\"VEGA908\",\"VEGA90A\"]"

    outputs:
      python_version: ${{ steps.pyver.outputs.python_version }}
      exec_model: ${{ steps.exec_model.outputs.exec_model }}
      amd_arch: ${{ steps.amd_arch.outputs.amd_arch }}
